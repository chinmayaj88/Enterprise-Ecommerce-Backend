name: gateway-service
fullNameOverride: ""
namespace: gateway-service

image:
image:
  repository: <OCI_REGISTRY>/gateway-service
  pullPolicy: Always
  tag: "latest"

# Replica configuration
replicaCount: 3

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Service configuration
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  annotations: {}

# Environment variables
env:
  NODE_ENV: production
  PORT: "3000"
  
# Service URLs
serviceUrls:
  authService: "http://auth-service:3001"
  userService: "http://user-service:3002"
  productService: "http://product-service:3003"
  cartService: "http://cart-service:3004"
  orderService: "http://order-service:3005"
  paymentService: "http://payment-service:3006"
  notificationService: "http://notification-service:3007"
  discountService: "http://discount-service:3008"
  shippingService: "http://shipping-service:3009"
  returnService: "http://return-service:3010"

# Secrets configuration
secrets:
  name: gateway-secrets
  jwtSecret:
    key: jwt-secret

# OCI Configuration
oci:
  compartmentId: "<COMPARTMENT_ID_FROM_TERRAFORM_OUTPUT>"
  region: "IN-HYDERABAD-1"
  dynamicGroup: "ecommerce-gateway-service-production"

# Redis configuration
redis:
  url: "<REDIS_URL_FROM_TERRAFORM_OUTPUT>"

# Resource limits
resources:
  requests:
    cpu: "200m"
    memory: "512Mi"
  limits:
    cpu: "2000m"
    memory: "2Gi"

# Health probes
probes:
  startup:
    enabled: true
    path: /health
    port: 3000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30
    successThreshold: 1
  liveness:
    enabled: true
    path: /health
    port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
    successThreshold: 1
  readiness:
    enabled: true
    path: /ready
    port: 3000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
    successThreshold: 1

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# Pod security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Priority class
priorityClassName: critical-priority

# Termination grace period
terminationGracePeriodSeconds: 30

# Service account
serviceAccount:
  create: true
  name: gateway-service-sa
  annotations:
    oci.oraclecloud.com/oci-identity-dynamic-group: "ecommerce-gateway-service-production"

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2
  # maxUnavailable: 1  # Alternative to minAvailable

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 1
          periodSeconds: 60
      selectPolicy: Min
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
        - type: Pods
          value: 2
          periodSeconds: 15
      selectPolicy: Max

# Network policy
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 3000
    - from:
        - namespaceSelector:
            matchLabels:
              name: gateway-service
      ports:
        - protocol: TCP
          port: 3000
    - from:
        - namespaceSelector:
            matchLabels:
              name: monitoring
      ports:
        - protocol: TCP
          port: 3000
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: UDP
          port: 53
    - to:
        - namespaceSelector:
            matchLabels:
              name: auth-service
      ports:
        - protocol: TCP
          port: 3001
    - to: []
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 80

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/limit-rps: "100"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    oci.oraclecloud.com/oci-load-balancer-shape: "flexible"
    oci.oraclecloud.com/oci-load-balancer-shape-flex-min: "10"
    oci.oraclecloud.com/oci-load-balancer-shape-flex-max: "100"
  hosts:
    - host: api.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: gateway-tls-secret
      hosts:
        - api.yourdomain.com

# Pod affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - gateway
          topologyKey: kubernetes.io/hostname

# Prometheus monitoring
monitoring:
  enabled: true
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3000"
    prometheus.io/path: "/metrics"

# Labels
labels:
  app: gateway
  service: gateway-service
  environment: production

# Annotations
annotations: {}

